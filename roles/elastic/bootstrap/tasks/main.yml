---
# tasks file for bootstrap

- name: elastic_pw
  delegate_to: localhost
  set_fact:
    pw: "{{ lookup('file', '{{ local_install_dir }}/{{ es_clustername }}/security') }}"
  when: es_security == true  
  tags:
    - bootstrap

- name: elastic_pw
  delegate_to: localhost
  set_fact:
#    kibana: "{{ 'PASSWORD kibana_system = gndlttvbgjj3L3ncX1ti PASSWORD kibana = gndlttvbgjj3L3ncX1ti'  |  regex_search('kibana_system = ([a-zA-Z0-9]*)', '\\1') }}"
    elastic_pw: "{{ pw |string | regex_search('elastic = ([a-zA-Z0-9]*)', '\\1') | first}}"
  when: es_security == true  
  tags:
    - bootstrap

- debug: msg="the value of elastic is {{ elastic }}"
  when: es_security == true  
  tags:
    - bootstrap

- name : Find security/role/*.json
  delegate_to: localhost
  become: true
  find:
    paths: "{{ local_install_root }}/roles/elastic/files/_security/role"
    file_type: file
  register: roles

- name : Find security/user/*.json
  delegate_to: localhost
  become: true
  find:
    paths: "{{ local_install_root }}/roles/elastic/files/_security/user"
    file_type: file
  register: users

- debug: var=item.path
  with_items: "{{ roles.files }}"

- debug: var=item.path
  with_items: "{{ users.files }}"  