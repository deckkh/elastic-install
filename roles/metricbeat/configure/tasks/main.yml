---
# tasks file for configure

- name: Populate service facts
  service_facts:    
  tags:
    - configure

- name: Configure kibana module
  template:
    src: "kibana-xpack.yml.j2"
    dest: "/etc/metricbeat/modules.d/kibana.yml"
  when: ansible_facts.services['kibana.service'] is defined    
  notify:
    - restart
  tags:
    - configure  

- name: Configure logstash module
  template:
    src: "logstash-xpack.yml.j2"
    dest: "/etc/metricbeat/modules.d/logstash.yml"
  when: ansible_facts.services['logstash.service'] is defined    
  notify:
    - restart
  tags:
    - configure  

- name: Configure elasticsearch module
  template:
    src: "kibana-xpack.yml.j2"
    dest: "/etc/metricbeat/modules.d/elasticsearch.yml"
  when: ansible_facts.services['elasticsearch.service'] is defined    
  notify:
    - restart
  tags:
    - configure  

- name: Configure metricbeat.yml
  template:
    src: "metricbeat.yml.j2"
    dest: "/etc/metricbeat/metricbeat.yml"
  notify:
    - restart
  tags:
    - configure  
